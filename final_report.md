# Итоговый отчет: Система автоматического сбора данных Facebook Ad Spend

## Резюме

Разработана полная система для автоматизированного сбора данных о расходах на рекламу Facebook с использованием антидетект-браузеров. Система обеспечивает безопасный сбор данных без риска блокировки аккаунтов и полностью автоматизирована для работы по расписанию.

## Ключевые преимущества решения

### 1. Имитация реального пользователя
- Каждый запрос к Facebook API выполняется через отдельный профиль антидетект-браузера
- Используются уникальные прокси, куки и отпечатки браузера для каждого профиля
- Facebook видит запросы как исходящие от реальных пользователей

### 2. Полная автоматизация
- Система работает по расписанию через cron без ручного вмешательства
- Автоматическое управление профилями антидетект-браузера (запуск/закрытие)
- Автоматическое сохранение данных в базу данных

### 3. Масштабируемость и гибкость
- Легкое добавление новых профилей Facebook через конфигурационный файл
- Поддержка множественных рекламных аккаунтов
- Модульная архитектура для легкой модификации и расширения

### 4. Надежность и безопасность
- Подробное логирование всех операций
- Обработка ошибок и механизмы восстановления
- Безопасное хранение токенов доступа

## Архитектура системы

Система состоит из 5 основных компонентов:

1. **Менеджер профилей антидетект-браузера** - управление профилями через API
2. **Клиент Facebook Graph API** - получение данных о расходах и объявлениях
3. **Менеджер базы данных** - хранение и управление собранными данными
4. **Оркестратор** - координация работы всех компонентов
5. **Планировщик** - автоматический запуск по расписанию

## Технические характеристики

### Поддерживаемые антидетект-браузеры
- Dolphin Anty (рекомендуется)
- AdsPower
- Undetectable.io

### Поддерживаемые базы данных
- SQLite (по умолчанию, для простоты развертывания)
- PostgreSQL (для больших объемов данных)

### Собираемые метрики
- Расходы (spend)
- Показы (impressions)
- Клики (clicks)
- CTR, CPC, CPM
- Данные по конкретным ad.id или всем объявлениям аккаунта

### Гибкие настройки
- Диапазоны времени для сбора данных
- Ежедневная разбивка или общие данные за период
- Задержки между обработкой профилей
- Фильтрация по конкретным объявлениям

## Процесс работы системы

1. **Планировщик (cron)** запускает главный скрипт по расписанию
2. **Оркестратор** загружает конфигурацию и список профилей
3. Для каждого профиля:
   - Запускается соответствующий профиль антидетект-браузера
   - Выполняются запросы к Facebook Graph API через прокси профиля
   - Полученные данные сохраняются в базу данных
   - Профиль антидетект-браузера закрывается
4. Система переходит в режим ожидания до следующего запуска

## Безопасность и соответствие

- Все запросы выполняются через уникальные прокси каждого профиля
- Используются реальные отпечатки браузера из антидетект-профилей
- Соблюдаются лимиты Facebook API
- Настраиваемые задержки между запросами для снижения нагрузки
- Безопасное хранение токенов доступа

## Готовые файлы системы

Система включает следующие готовые к использованию файлы:

1. **anti_detect_browser_manager.py** - Модуль управления антидетект-браузером
2. **facebook_api_client.py** - Клиент для работы с Facebook Graph API
3. **database_manager.py** - Менеджер базы данных
4. **orchestrator.py** - Главный оркестратор системы
5. **main.py** - Исполняемый скрипт для запуска
6. **config.json** - Пример конфигурационного файла
7. **requirements.txt** - Список зависимостей Python
8. **install.sh** - Скрипт автоматической установки
9. **README.md** - Подробная документация

## Инструкции по развертыванию

### Быстрый старт

1. Скачайте все файлы системы
2. Запустите скрипт установки: `./install.sh`
3. Отредактируйте `config.json` с вашими данными:
   - Facebook Access Token
   - ID профилей антидетект-браузера
   - ID рекламных аккаунтов
   - Настройки прокси
4. Протестируйте систему: `python3 main.py`
5. Настройте cron для автоматического запуска

### Настройка cron

Добавьте в crontab строку для запуска каждые 6 часов:
```
0 */6 * * * /path/to/project/venv/bin/python3 /path/to/project/main.py >> /path/to/project/logs/cron.log 2>&1
```

## Примеры использования

### Сбор данных за последний день
```json
{
  "days_back": 1,
  "daily_breakdown": true
}
```

### Сбор данных по конкретным объявлениям
```json
{
  "profiles": [
    {
      "profile_id": "uuid",
      "ad_account_id": "123456",
      "ad_ids": ["ad_id_1", "ad_id_2"]
    }
  ]
}
```

### Настройка для больших объемов данных
```json
{
  "database_type": "postgresql",
  "database_path": "postgresql://user:pass@localhost/dbname",
  "delay_between_profiles": 30
}
```

## Мониторинг и обслуживание

- Логи сохраняются в `facebook_spend_collector.log`
- Данные хранятся в таблице `ad_spend` с полной историей
- Система автоматически обрабатывает дубликаты данных
- Встроенная обработка ошибок и повторные попытки

## Заключение

Разработанная система предоставляет полное решение для автоматизированного сбора данных Facebook Ad Spend с использованием антидетект-браузеров. Система готова к немедленному развертыванию и использованию, обеспечивает высокий уровень безопасности и может быть легко адаптирована под конкретные требования.

Ключевые достоинства:
- ✅ Полная автоматизация без ручного вмешательства
- ✅ Безопасность через имитацию реальных пользователей
- ✅ Масштабируемость для множественных аккаунтов
- ✅ Готовый к использованию код и документация
- ✅ Гибкая конфигурация под различные сценарии

